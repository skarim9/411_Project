var uritemplate=function(){function n(n){return"function"==typeof n}function e(n){for(var e in n)return!1;return!0}function r(n,e){for(var r in e)n[r]=e[r];return n}function t(n){this.raw=n,this.cache={}}function i(n){this.set=n}function o(n){this.txt=n}function u(n){return encodeURIComponent(n).replace(w,function(n){return escape(n)})}function a(n){return encodeURI(n)}function s(n,e,r){return e+(e.length>0?"=":"")+r}function c(n,e,r,t){return t=t||!1,t&&(n=""),e&&0!==e.length||(e=n),e+(e.length>0?"=":"")+r}function p(n,e,r,t){return t=t||!1,t&&(n=""),e&&0!==e.length||(e=n),e+(e.length>0&&r?"=":"")+r}function f(n,e){r(this,n),this.vars=e}function l(n){this.str="",n===R?this.appender=l.UnboundAppend:(this.len=0,this.limit=n,this.appender=l.BoundAppend)}function d(n,e,r){var t=new l(r),i="",o=0,u=n.length;for(o=0;u>o;o++)null!==n[o]&&void 0!==n[o]&&(t.append(i).append(n[o],e),i=",");return t.str}function h(n,e,r){var t,i=new l(r),o="";for(t in n)n.hasOwnProperty(t)&&null!==n[t]&&void 0!==n[t]&&(i.append(o+t+",").append(n[t],e),o=",");return i.str}function v(n,e,r,t,i){var o;if(r.isArr)o=d(e,t,n.maxLength);else if(r.isObj)o=h(e,t,n.maxLength);else{var u=new l(n.maxLength);o=u.append(e,t).str}i("",o)}function b(n,e,r,t,i){if(r.isArr){var o=0,u=e.length;for(o=0;u>o;o++)i("",t(e[o]))}else if(r.isObj){var a;for(a in e)e.hasOwnProperty(a)&&i(a,t(e[a]))}else i("",t(e))}function x(n){var r=!1,t=!1,i=!0;return null!==n&&void 0!==n&&(r=n.constructor===Array,t=n.constructor===Object,i=r&&0===n.length||t&&e(n)),{isArr:r,isObj:t,isUndef:i}}function g(n,e,r){this.name=unescape(n),this.valueHandler=e,this.maxLength=r}t.prototype.get=function(e){var r=this.lookupRaw(e),t=r;if(n(r)){var i=this.cache[e];null!==i&&void 0!==i?t=i.val:(t=r(this.raw),this.cache[e]={key:e,val:t})}return t},t.prototype.lookupRaw=function(n){return t.lookup(this,this.raw,n)},t.lookup=function(n,e,r){var i=e[r];if(void 0!==i)return i;var o=r.split("."),u=0,a=o.length-1;for(u=0;a>u;u++){var s=o.slice(0,a-u).join("."),c=o.slice(-u-1).join("."),p=e[s];if(void 0!==p)return t.lookup(n,p,c)}return void 0},i.prototype.expand=function(n){var e=new t(n),r="",i=0,o=this.set.length;for(i=0;o>i;i++)r+=this.set[i].expand(e);return r},o.prototype.expand=function(){return this.txt};var w=new RegExp("[:/?#\\[\\]@!$&()*+,;=']","g"),j={prefix:"",joiner:",",encode:u,builder:s},k={prefix:"",joiner:",",encode:a,builder:s},m={prefix:"#",joiner:",",encode:a,builder:s},y={prefix:";",joiner:";",encode:u,builder:p},A={prefix:"?",joiner:"&",encode:u,builder:c},U={prefix:"&",joiner:"&",encode:u,builder:c},O={prefix:"/",joiner:"/",encode:u,builder:s},I={prefix:".",joiner:".",encode:u,builder:s};f.build=function(n,e){var r;switch(n){case"":r=j;break;case"+":r=k;break;case"#":r=m;break;case";":r=y;break;case"?":r=A;break;case"&":r=U;break;case"/":r=O;break;case".":r=I;break;default:throw"Unexpected operator: '"+n+"'"}return new f(r,e)},f.prototype.expand=function(n){var e=this.prefix,r=this.joiner,t=this.builder,i="",o=0,u=this.vars.length;for(o=0;u>o;o++){var a=this.vars[o];a.addValues(n,this.encode,function(n,o,u){var s=t(a.name,n,o,u);null!==s&&void 0!==s&&(i+=e+s,e=r)})}return i};var R={};l.prototype.append=function(n,e){return this.appender(this,n,e)},l.UnboundAppend=function(n,e,r){return e=r?r(e):e,n.str+=e,n},l.BoundAppend=function(n,e,r){return e=e.substring(0,n.limit-n.len),n.len+=e.length,e=r?r(e):e,n.str+=e,n},g.build=function(n,e,r,t){var i;return i=e?b:v,r||(t=R),new g(n,i,t)},g.prototype.addValues=function(n,e,r){var t=n.get(this.name),i=x(t);i.isUndef||this.valueHandler(this,t,i,e,r)};var L=/([^*:]*)((\*)|(:)([0-9]+))?/,$=function(n){var e=n[1],r=n[3],t=n[4],i=parseInt(n[5],10);return g.build(e,r,t,i)},B=",",H=/(\{([+#.;?&\/])?(([^.*:,{}|@!=$()][^*:,{}$()]*)(\*|:([0-9]+))?(,([^.*:,{}][^*:,{}]*)(\*|:([0-9]+))?)*)\})/g,P=function(n){var e=(n[0],n[2]||""),r=n[3].split(B),t=0,i=r.length;for(t=0;i>t;t++){var o;if(null===(o=r[t].match(L)))throw"unexpected parse error in varspec: "+r[t];r[t]=$(o)}return f.build(e,r)},V=function(n,e,r,t){if(t>r){var i=e.substr(r,t-r);n.push(new o(i))}},C=function(n){var e,r=0,t=[],o=H;for(o.lastIndex=0;null!==(e=o.exec(n));){var u=e.index;V(t,n,r,u),t.push(P(e)),r=o.lastIndex}return V(t,n,r,n.length),new i(t)};return C}();